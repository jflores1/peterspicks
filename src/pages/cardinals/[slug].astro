---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

// Generate routes for all cardinals
export async function getStaticPaths() {
    const cardinals = await getCollection("cardinals");
    return cardinals.map((entry) => ({
        params: { slug: entry.slug },
        props: { entry },
    }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={`Cardinal ${entry.data.name} | Conclave Tracker`}>
    <main>
        <div class="cardinal-header">
            <div class="cardinal-image">
                <img
                    src={entry.data.image}
                    alt={`Cardinal ${entry.data.name}`}
                />
            </div>
            <div class="cardinal-title">
                <h1>{entry.data.name}</h1>
                <p class="title">{entry.data.title}</p>
                {
                    entry.data.is_papabile && (
                        <div class="papabile-badge">Papabile</div>
                    )
                }
            </div>
        </div>

        <div class="cardinal-details">
            <div class="stats-card">
                <h2>Cardinal Details</h2>
                <div class="stat-row">
                    <div class="stat-label">Country:</div>
                    <div class="stat-value">{entry.data.country}</div>
                </div>
                <div class="stat-row">
                    <div class="stat-label">Age:</div>
                    <div class="stat-value">{entry.data.age}</div>
                </div>
                <div class="stat-row">
                    <div class="stat-label">Created Cardinal:</div>
                    <div class="stat-value">{entry.data.created_cardinal}</div>
                </div>
                {
                    entry.data.papal_probability && (
                        <div class="stat-row">
                            <div class="stat-label">Papal Probability:</div>
                            <div class="stat-value">
                                {(entry.data.papal_probability * 100).toFixed(
                                    1,
                                )}
                                %
                            </div>
                        </div>
                    )
                }
                {
                    entry.data.voting_history && (
                        <div class="stat-block">
                            <h3>Voting History</h3>
                            <ul>
                                {entry.data.voting_history.map((item) => (
                                    <li>{item}</li>
                                ))}
                            </ul>
                        </div>
                    )
                }
            </div>

            <div class="bio-content">
                <h2>Biography</h2>
                <div class="content">
                    <Content />
                </div>

                <div class="ai-analysis">
                    <h2>AI Analysis</h2>
                    <p>
                        Our AI system predicts this cardinal has a
                        {(entry.data.papal_probability * 100).toFixed(1)}%
                        chance of becoming the next Pope based on historical
                        patterns and current Church dynamics.
                    </p>

                    <!-- This is where you would add your AI interaction components -->
                    <button class="ai-button">Generate More Analysis</button>
                </div>
            </div>
        </div>

        <div class="back-link">
            <a href="/">‚Üê Back to All Cardinals</a>
        </div>
    </main>
</Layout>

<style>
    main {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }

    .cardinal-header {
        display: flex;
        margin-bottom: 30px;
        align-items: center;
    }

    .cardinal-image {
        width: 200px;
        height: 250px;
        overflow: hidden;
        border-radius: 10px;
        margin-right: 30px;
    }

    .cardinal-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .cardinal-title h1 {
        margin: 0 0 10px 0;
        color: #722f37;
    }

    .title {
        font-style: italic;
        font-size: 1.2rem;
        margin: 0 0 15px 0;
        color: #555;
    }

    .papabile-badge {
        display: inline-block;
        background: #722f37;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.9rem;
    }

    .cardinal-details {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    .stats-card {
        background: #f8f8f8;
        border-radius: 10px;
        padding: 20px;
    }

    .stats-card h2 {
        margin-top: 0;
        color: #722f37;
        font-size: 1.3rem;
    }

    .stat-row {
        display: flex;
        margin-bottom: 10px;
    }

    .stat-label {
        font-weight: bold;
        width: 140px;
        color: #555;
    }

    .stat-block {
        margin-top: 20px;
    }

    .stat-block h3 {
        font-size: 1.1rem;
        color: #555;
        margin-bottom: 10px;
    }

    .bio-content h2 {
        color: #722f37;
        margin-top: 0;
    }

    .content {
        line-height: 1.6;
    }

    .ai-analysis {
        margin-top: 40px;
        padding: 20px;
        background: #f0f0f0;
        border-radius: 10px;
        border-left: 4px solid #722f37;
    }

    .ai-button {
        background: #722f37;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 15px;
        transition: background-color 0.2s;
    }

    .ai-button:hover {
        background: #5a252b;
    }

    .back-link {
        margin-top: 40px;
    }

    .back-link a {
        color: #722f37;
        text-decoration: none;
    }

    .back-link a:hover {
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .cardinal-header {
            flex-direction: column;
            text-align: center;
        }

        .cardinal-image {
            margin: 0 auto 20px auto;
        }

        .cardinal-details {
            grid-template-columns: 1fr;
        }
    }
</style>
